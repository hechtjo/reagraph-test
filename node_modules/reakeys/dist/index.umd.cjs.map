{"version":3,"file":"index.umd.cjs","sources":["../src/useHotkeyState.ts","../src/useHotkeys.ts","../src/utils.ts"],"sourcesContent":["import { RefObject, useEffect, useState } from 'react';\nimport Mousetrap, {\n  ExtendedKeyboardEvent,\n  MousetrapInstance,\n  MousetrapStatic,\n} from 'mousetrap';\n\nexport interface HotkeyShortcuts {\n  name: string;\n  category?: string;\n  description?: string;\n  keys: string | string[];\n  ref?: RefObject<HTMLElement | null>;\n  hidden?: boolean;\n  disabled?: boolean;\n  callback: (e: ExtendedKeyboardEvent, combo: string) => void;\n  action?: 'keypress' | 'keydown' | 'keyup';\n}\n\n/**\n * Creates a global state singleton.\n */\nconst createStateHook = () => {\n  const mousetraps = new Map<\n    HTMLElement | undefined,\n    MousetrapStatic | MousetrapInstance\n  >();\n  let keys: HotkeyShortcuts[] = [];\n\n  const bindKeys = (nextKeys: HotkeyShortcuts[]) => {\n    nextKeys.forEach((k) => {\n      if (k.disabled) {\n        return;\n      }\n\n      if (k.ref) {\n        if (!k.ref.current) {\n          // exit early if ref is provided but null\n          // we do not want to attach global event handlers in this case\n          return;\n        }\n\n        const element = k.ref.current;\n\n        if (!mousetraps.has(element)) {\n          mousetraps.set(element, new Mousetrap(element));\n        }\n\n        mousetraps.get(element)!.bind(k.keys, k.callback, k.action);\n      } else {\n        if (!mousetraps.get(undefined)) {\n          mousetraps.set(undefined, Mousetrap);\n        }\n\n        mousetraps.get(undefined)!.bind(k.keys, k.callback, k.action);\n      }\n    });\n  };\n\n  const addKeys = (nextKeys: HotkeyShortcuts[]) => {\n    keys = [...keys, ...nextKeys];\n\n    bindKeys(nextKeys);\n  };\n\n  const removeKeys = (nextKeys: HotkeyShortcuts[]) => {\n    // remove keys from the array\n    keys = keys.filter((k) => !nextKeys.includes(k));\n\n    // unbind mousetrap events\n    nextKeys.forEach((k) => {\n      if (k.ref) {\n        if (!k.ref.current) {\n          return;\n        }\n\n        mousetraps.get(k.ref.current)?.unbind(k.keys, k.action);\n      } else {\n        mousetraps.get(undefined)?.unbind(k.keys, k.action);\n      }\n    });\n\n    // drop mousetrap instances that have no keys attached anymore\n    for (const [element] of mousetraps) {\n      if (element === undefined) {\n        if (keys.some((k) => k.ref === undefined)) {\n          continue;\n        }\n      } else {\n        if (keys.some((k) => k.ref?.current === element)) {\n          continue;\n        }\n      }\n\n      mousetraps.delete(element);\n    }\n\n    // re-bind keys to restore listeners that were overwritten by the ones we just removed\n    bindKeys(keys);\n  };\n\n  return () => {\n    const [state, setState] = useState<HotkeyShortcuts[]>([]);\n\n    useEffect(() => {\n      setState(keys);\n    }, []);\n\n    return [state, addKeys, removeKeys] as const;\n  };\n};\n\nexport const useHotkeyState = createStateHook();\n","import { useLayoutEffect, useMemo } from 'react';\nimport { HotkeyShortcuts, useHotkeyState } from './useHotkeyState';\n\nexport const useHotkeys = (shortcuts?: HotkeyShortcuts[]) => {\n  const [keys, addKeys, removeKeys] = useHotkeyState();\n\n  useLayoutEffect(() => {\n    if (shortcuts) {\n      addKeys(shortcuts);\n    }\n\n    return () => {\n      if (shortcuts) {\n        removeKeys(shortcuts);\n      }\n    };\n  }, [addKeys, removeKeys, shortcuts]);\n\n  return useMemo(\n    () =>\n      keys.reduce<HotkeyShortcuts[]>((agg, cur) => {\n        if (!agg.find((a) => a.keys === cur.keys && a.ref && cur.ref)) {\n          agg.push(cur);\n        }\n        return agg;\n      }, []),\n    [keys]\n  );\n};\n","let isMac: boolean = false;\ntry {\n  if (navigator) isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;\n} catch (e) {\n  console.warn(e);\n}\n\nexport const MODIFIER_KEY = isMac ? '⌘' : 'CTRL';\n\nexport function getHotkeyText(hotkey: string) {\n  return hotkey\n    .replace('modifier', MODIFIER_KEY)\n    .replace('mod', MODIFIER_KEY)\n    .replace('shift', '⇧');\n}\n"],"names":["useState","useEffect","useLayoutEffect","useMemo"],"mappings":"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"}